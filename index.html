<!DOCTYPE html>
<html>
<head>
<title>Factory Inventory System</title>
<style>
body{font-family:Segoe UI; margin:0; background:#f4f6f8}
header{background:#2f4f4f;color:#fff;padding:12px;text-align:center;font-size:22px}
nav button{margin:5px;padding:10px 20px;border:none;border-radius:5px;cursor:pointer}
nav{background:#ddd;padding:10px;text-align:center}
.page{display:none;padding:20px}
.card{background:#fff;padding:15px;border-radius:8px;box-shadow:0 2px 5px #ccc;margin-bottom:15px}
input,select,button{padding:7px;margin:5px;border-radius:5px;border:1px solid #aaa}
table{width:100%;border-collapse:collapse;margin-top:10px}
th{background:#2f4f4f;color:white;padding:8px}
td{border-bottom:1px solid #ddd;padding:6px;text-align:center}
tr:hover{background:#f1f1f1}
.edit{background:#1e90ff;color:white}
.del{background:#ff4500;color:white}
.save{background:#4caf50;color:white}
</style>
</head>
<body>

<header>Factory Inventory System</header>
<nav>
<button onclick="show('entry')">Data Entry</button>
<button onclick="show('pending')">Data Pending</button>
<button onclick="show('incoming')">Incoming</button>
<button onclick="show('dash')">Dashboard</button>
</nav>

<!-- DATA ENTRY -->
<div id="entry" class="page">
<div class="card">
<h3>Data Entry (Final Production)</h3>
<input id="de_pi" placeholder="PI">
<input id="de_model" placeholder="Model">
<input id="de_colour" placeholder="Colour" onblur="loadBatch('de')">
<input id="de_set" placeholder="Set">
<input id="de_need" type="number" placeholder="Need">
<input id="de_issue" type="number" placeholder="Issue">
<select id="de_batch_select"></select>
<input id="de_batch_input" placeholder="Manual Batch" style="display:none">
<br>
<button class="save" onclick="saveData('de')">Save</button>
<button onclick="clearForm('de')">Clear</button>
<input id="de_search" placeholder="Search..." onkeyup="searchTable('de')">
</div>
<table>
<thead><tr><th>PI</th><th>Model</th><th>Colour</th><th>Need</th><th>Issue</th><th>Batch</th><th>Edit</th><th>Del</th></tr></thead>
<tbody id="de_table"></tbody>
</table>
</div>

<!-- DATA PENDING -->
<div id="pending" class="page">
<div class="card">
<h3>Data Pending (Temporary)</h3>
<input id="dp_pi" placeholder="PI">
<input id="dp_model" placeholder="Model">
<input id="dp_colour" placeholder="Colour" onblur="loadBatch('dp')">
<input id="dp_set" placeholder="Set">
<input id="dp_need" type="number" placeholder="Need">
<input id="dp_issue" type="number" placeholder="Issue">
<select id="dp_batch_select"></select>
<input id="dp_batch_input" placeholder="Manual Batch" style="display:none">
<br>
<button class="save" onclick="saveData('dp')">Save</button>
<button onclick="clearForm('dp')">Clear</button>
<input id="dp_search" placeholder="Search..." onkeyup="searchTable('dp')">
</div>
<table>
<thead><tr><th>PI</th><th>Model</th><th>Colour</th><th>Need</th><th>Issue</th><th>Batch</th><th>Edit</th><th>Del</th></tr></thead>
<tbody id="dp_table"></tbody>
</table>
</div>

<!-- INCOMING -->
<div id="incoming" class="page">
<div class="card">
<h3>Incoming (Raw Stock)</h3>
<input id="in_colour" placeholder="Colour">
<input id="in_batch" placeholder="Batch">
<input id="in_total" type="number" placeholder="Total SQF">
<button class="save" onclick="saveIncoming()">Save</button>
</div>
<table>
<thead><tr><th>Colour</th><th>Batch</th><th>Total SQF</th><th>Del</th></tr></thead>
<tbody id="in_table"></tbody>
</table>
</div>

<!-- DASHBOARD -->
<div id="dash" class="page">
<div class="card">
<h3>Dashboard</h3>
<p>Total Final Records: <b id="d1"></b></p>
<p>Total Need SQF: <b id="d2"></b></p>
<p>Total Issue SQF: <b id="d3"></b></p>
<p>Total Pending Records: <b id="d4"></b></p>
<p>Total Stock Entries: <b id="d5"></b></p>
</div>
</div>

<script>
let data = JSON.parse(localStorage.data||"[]")
let pending = JSON.parse(localStorage.pending||"[]")
let incoming = JSON.parse(localStorage.incoming||"[]")
let editIndex=null

function show(id){
document.querySelectorAll('.page').forEach(p=>p.style.display='none')
document.getElementById(id).style.display='block'
drawAll()
}

function loadBatch(p){
let colour = document.getElementById(p+"_colour").value.toLowerCase()
let sel = document.getElementById(p+"_batch_select")
let inp = document.getElementById(p+"_batch_input")
sel.innerHTML=""
let found=false
incoming.filter(i=>i.colour.toLowerCase()==colour).forEach(i=>{
sel.innerHTML+=`<option>${i.batch}</option>`
found=true
})
if(found){sel.style.display='inline';inp.style.display='none'}
else{sel.style.display='none';inp.style.display='inline'}
}

function saveData(p){
let obj={
pi:document.getElementById(p+"_pi").value,
model:document.getElementById(p+"_model").value,
colour:document.getElementById(p+"_colour").value,
need:document.getElementById(p+"_need").value,
issue:document.getElementById(p+"_issue").value,
batch:document.getElementById(p+"_batch_input").value || document.getElementById(p+"_batch_select").value
}
if(p=='de'){data.push(obj);localStorage.data=JSON.stringify(data)}
else{pending.push(obj);localStorage.pending=JSON.stringify(pending)}
clearForm(p);drawAll()
}

function saveIncoming(){
incoming.push({
colour:in_colour.value,
batch:in_batch.value,
total:in_total.value
})
localStorage.incoming=JSON.stringify(incoming)
in_colour.value="";in_batch.value="";in_total.value=""
drawAll()
}

function drawAll(){
de_table.innerHTML=""
data.forEach((e,i)=>{
de_table.innerHTML+=`<tr>
<td>${e.pi}</td><td>${e.model}</td><td>${e.colour}</td>
<td>${e.need}</td><td>${e.issue}</td><td>${e.batch}</td>
<td><button class="edit" onclick="edit('de',${i})">Edit</button></td>
<td><button class="del" onclick="del('de',${i})">X</button></td>
</tr>`
})

dp_table.innerHTML=""
pending.forEach((e,i)=>{
dp_table.innerHTML+=`<tr>
<td>${e.pi}</td><td>${e.model}</td><td>${e.colour}</td>
<td>${e.need}</td><td>${e.issue}</td><td>${e.batch}</td>
<td><button class="edit" onclick="edit('dp',${i})">Edit</button></td>
<td><button class="del" onclick="del('dp',${i})">X</button></td>
</tr>`
})

in_table.innerHTML=""
incoming.forEach((e,i)=>{
in_table.innerHTML+=`<tr>
<td>${e.colour}</td><td>${e.batch}</td><td>${e.total}</td>
<td><button class="del" onclick="del('in',${i})">X</button></td>
</tr>`
})

d1.innerText=data.length
d2.innerText=data.reduce((s,e)=>s+Number(e.need),0)
d3.innerText=data.reduce((s,e)=>s+Number(e.issue),0)
d4.innerText=pending.length
d5.innerText=incoming.length
}

function del(p,i){
if(p=='de'){data.splice(i,1);localStorage.data=JSON.stringify(data)}
if(p=='dp'){pending.splice(i,1);localStorage.pending=JSON.stringify(pending)}
if(p=='in'){incoming.splice(i,1);localStorage.incoming=JSON.stringify(incoming)}
drawAll()
}

function edit(p,i){
let e = p=='de'?data[i]:pending[i]
document.getElementById(p+"_pi").value=e.pi
document.getElementById(p+"_model").value=e.model
document.getElementById(p+"_colour").value=e.colour
document.getElementById(p+"_need").value=e.need
document.getElementById(p+"_issue").value=e.issue
loadBatch(p)
}

function clearForm(p){
["pi","model","colour","need","issue","batch_input"].forEach(f=>{
let el=document.getElementById(p+"_"+f)
if(el) el.value=""
})
}

function searchTable(p){
let val=document.getElementById(p+"_search").value.toLowerCase()
let arr=p=='de'?data:pending
let tbody=document.getElementById(p+"_table")
tbody.innerHTML=""
arr.filter(e=>e.pi.toLowerCase().includes(val)||e.model.toLowerCase().includes(val)||e.colour.toLowerCase().includes(val))
.forEach((e,i)=>{
tbody.innerHTML+=`<tr>
<td>${e.pi}</td><td>${e.model}</td><td>${e.colour}</td>
<td>${e.need}</td><td>${e.issue}</td><td>${e.batch}</td>
<td><button class="edit" onclick="edit('${p}',${i})">Edit</button></td>
<td><button class="del" onclick="del('${p}',${i})">X</button></td>
</tr>`
})
}

show('entry')
</script>
</body>
</html>
